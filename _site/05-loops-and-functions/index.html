






<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2023-10-17 15:39:28 +0100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/favicons/dc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/favicons/dc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/favicons/dc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/favicons/dc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/favicons/dc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/favicons/dc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/favicons/dc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/favicons/dc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/assets/favicons/dc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/assets/favicons/dc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/assets/favicons/dc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/assets/favicons/dc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/assets/favicons/dc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Data Carpentry - Data Analysis and Visualization in Python for Ecologists"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/assets/favicons/dc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/assets/favicons/dc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/assets/favicons/dc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/assets/favicons/dc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/assets/favicons/dc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Data Workflows and Automation &ndash; Data Analysis and Visualization in Python for Ecologists
  </title>

  </head>
  <body>

    
















    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="/assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="/index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="/CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="/setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="/00-before-we-start/index.html">Before we start</a></li>
            
            
            <li><a href="/01-short-introduction-to-Python/index.html">Short Introduction to Programming in Python</a></li>
            
            
            <li><a href="/02-starting-with-data/index.html">Starting With Data</a></li>
            
            
            <li><a href="/03-index-slice-subset/index.html">Indexing, Slicing and Subsetting DataFrames in Python</a></li>
            
            
            <li><a href="/04-visualization-ggplot-python/index.html">Making Plots With matplotlib/seaborn</a></li>
            
            
            <li><a href="/05-loops-and-functions/index.html">Data Workflows and Automation</a></li>
            
            
            <li><a href="/07-visualization-ggplot-python/index.html">Making Plots With matplotlib/seaborn</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="/aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
        
	

	
	
        <li class="dropdown">
          <a href="/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/reference.html">Reference</a></li>
            
            
            
              <li><a href="/CONTRIBUTORS/index.html">About Contributors</a></li>
            
            
            
            
              <li><a href="/about/index.html">About</a></li>
            
            
            
            
              <li><a href="/discuss/index.html">Discussion</a></li>
            
            
            
            
              <li><a href="/extra_challenges/index.html"> Extra Challenges</a></li>
            
            
            
            
              <li><a href="/figures/index.html">Figures</a></li>
            
            
            
            
              <li><a href="/guide/index.html">Instructor Notes</a></li>
            
            
            
            
              <li><a href="/jupyter_notebooks/index.html">Overview of Jupyter Notebooks</a></li>
            
            
          </ul>
        </li>
	

	
        <li><a href="/LICENSE.html">License</a></li>
        

        
	<li><a href="/edit//_episodes/05-loops-and-functions.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>



















  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="/04-visualization-ggplot-python/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="/">Data Analysis and Visualization in Python for Ecologists</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="/07-visualization-ggplot-python/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Data Workflows and Automation</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br/>
      <strong>Exercises:</strong> 50 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>Can I automate operations in Python?</p>
</li>
	
	<li><p>What are functions and why should I use them?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe why for loops are used in Python.</p>
</li>
	
	<li><p>Employ for loops to automate data analysis.</p>
</li>
	
	<li><p>Write unique filenames in Python.</p>
</li>
	
	<li><p>Build reusable code in Python.</p>
</li>
	
	<li><p>Write functions using conditional statements (if, then, else).</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>So far, we’ve used Python and the pandas library to explore and manipulate
individual datasets by hand, much like we would do in a spreadsheet. The beauty
of using a programming language like Python, though, comes from the ability to
automate data processing through the use of loops and functions.</p>

<h2 id="automating-data-processing-using-for-loops">Automating data processing using For Loops</h2>

<p>The file we’ve been using so far, <code class="language-plaintext highlighter-rouge">surveys.csv</code>, contains 25 years of data and is
very large. We would like to separate the data for each year into a separate
file.</p>

<p>Let’s start by making a new directory inside the folder <code class="language-plaintext highlighter-rouge">data</code> to store all of
these files using the module <code class="language-plaintext highlighter-rouge">os</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">'data/yearly_files'</span><span class="p">)</span>
</code></pre></div></div>

<p>The command <code class="language-plaintext highlighter-rouge">os.mkdir</code> is equivalent to <code class="language-plaintext highlighter-rouge">mkdir</code> in the shell. Just so we are
sure, we can check that the new directory was created within the <code class="language-plaintext highlighter-rouge">data</code> folder:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'data'</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['plots.csv',
 'portal_mammals.sqlite',
 'species.csv',
 'survey2001.csv',
 'survey2002.csv',
 'surveys.csv',
 'surveys2002_temp.csv',
 'yearly_files']
</code></pre></div></div>

<p>The command <code class="language-plaintext highlighter-rouge">os.listdir</code> is equivalent to <code class="language-plaintext highlighter-rouge">ls</code> in the shell.</p>

<p>In previous lessons, we saw how to use the library pandas to load the species
data into memory as a DataFrame, how to select a subset of the data using some
criteria, and how to write the DataFrame into a CSV file. Let’s write a script
that performs those three steps in sequence for the year 2002:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>

<span class="c1"># Select only data for the year 2002
</span><span class="n">surveys2002</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2002</span><span class="p">]</span>

<span class="c1"># Write the new DataFrame to a CSV file
</span><span class="n">surveys2002</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data/yearly_files/surveys2002.csv'</span><span class="p">)</span>
</code></pre></div></div>

<p>To create yearly data files, we could repeat the last two commands over and
over, once for each year of data. Repeating code is neither elegant nor
practical, and is very likely to introduce errors into your code. We want to
turn what we’ve just written into a loop that repeats the last two commands for
every year in the dataset.</p>

<p>Let’s start by writing a loop that prints the names of the files we want
to create - the dataset we are using covers 1977 through 2002, and we’ll create
a separate file for each of those years. Listing the filenames is a good way to
confirm that the loop is behaving as we expect.</p>

<p>We have seen that we can loop over a list of items, so we need a list of years
to loop over. We can get the years in our DataFrame with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0        1977
1        1977
2        1977
3        1977
         ...
35545    2002
35546    2002
35547    2002
35548    2002
</code></pre></div></div>

<p>but we want only unique years, which we can get using the <code class="language-plaintext highlighter-rouge">unique</code> method
which we have already seen.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987,
       1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
       1999, 2000, 2001, 2002], dtype=int64)
</code></pre></div></div>

<p>Putting this into our for loop we get</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">unique</span><span class="p">():</span>
   <span class="n">filename</span><span class="o">=</span><span class="s">'data/yearly_files/surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
   <span class="k">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data/yearly_files/surveys1977.csv
data/yearly_files/surveys1978.csv
data/yearly_files/surveys1979.csv
data/yearly_files/surveys1980.csv
data/yearly_files/surveys1981.csv
data/yearly_files/surveys1982.csv
data/yearly_files/surveys1983.csv
data/yearly_files/surveys1984.csv
data/yearly_files/surveys1985.csv
data/yearly_files/surveys1986.csv
data/yearly_files/surveys1987.csv
data/yearly_files/surveys1988.csv
data/yearly_files/surveys1989.csv
data/yearly_files/surveys1990.csv
data/yearly_files/surveys1991.csv
data/yearly_files/surveys1992.csv
data/yearly_files/surveys1993.csv
data/yearly_files/surveys1994.csv
data/yearly_files/surveys1995.csv
data/yearly_files/surveys1996.csv
data/yearly_files/surveys1997.csv
data/yearly_files/surveys1998.csv
data/yearly_files/surveys1999.csv
data/yearly_files/surveys2000.csv
data/yearly_files/surveys2001.csv
data/yearly_files/surveys2002.csv
</code></pre></div></div>

<p>We can now add the rest of the steps we need to create separate text files:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">surveys_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">].</span><span class="n">unique</span><span class="p">():</span>

    <span class="c1"># Select data for the year
</span>    <span class="n">surveys_year</span> <span class="o">=</span> <span class="n">surveys_df</span><span class="p">[</span><span class="n">surveys_df</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>

    <span class="c1"># Write the new DataFrame to a CSV file
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="s">'data/yearly_files/surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
    <span class="n">surveys_year</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>

<p>Look inside the <code class="language-plaintext highlighter-rouge">yearly_files</code> directory and check a couple of the files you
just created to confirm that everything worked as expected.</p>

<h2 id="writing-unique-file-names">Writing Unique File Names</h2>

<p>Notice that the code above created a unique filename for each year.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="s">'data/yearly_files/surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
</code></pre></div></div>

<p>Let’s break down the parts of this name:</p>

<ul>
  <li>The first part is some text that specifies the directory to store our
data file in (data/yearly_files/) and the first part of the file name
(surveys): <code class="language-plaintext highlighter-rouge">'data/yearly_files/surveys'</code></li>
  <li>We can concatenate this with the value of a variable, in this case <code class="language-plaintext highlighter-rouge">year</code> by
using the plus <code class="language-plaintext highlighter-rouge">+</code> sign and the variable we want to add to the file name: <code class="language-plaintext highlighter-rouge">+
str(year)</code></li>
  <li>Then we add the file extension as another text string: <code class="language-plaintext highlighter-rouge">+ '.csv'</code></li>
</ul>

<p>Notice that we use single quotes to add text strings. The variable is not
surrounded by quotes. This code produces the string
<code class="language-plaintext highlighter-rouge">data/yearly_files/surveys2002.csv</code> which contains the path to the new filename
AND the file name itself.</p>

<blockquote class="challenge">
  <h2 id="challenge---modifying-loops">Challenge - Modifying loops</h2>

  <ol>
    <li>
      <p>Some of the surveys you saved are missing data (they have null values that
show up as NaN - Not A Number - in the DataFrames and do not show up in the text
files). Modify the for loop so that the entries with null values are not
included in the yearly files.</p>
    </li>
    <li>
      <p>Let’s say you only want to look at data from a given multiple of years. How would you modify your loop in order to generate a data file for only every 5th year, starting from 1977?</p>
    </li>
    <li>
      <p>Instead of splitting out the data by years, a colleague wants to do analyses each species separately. How would you write a unique CSV file for each species?</p>
    </li>
  </ol>
</blockquote>

<h2 id="building-reusable-and-modular-code-with-functions">Building reusable and modular code with functions</h2>

<p>Suppose that separating large data files into individual yearly files is a task
that we frequently have to perform. We could write a <strong>for loop</strong> like the one above
every time we needed to do it but that would be time consuming and error prone.
A more elegant solution would be to create a reusable tool that performs this
task with minimum input from the user. To do this, we are going to turn the code
we’ve already written into a function.</p>

<p>Functions are reusable, self-contained pieces of code that are called with a
single command. They can be designed to accept arguments as input and return
values, but they don’t need to do either. Variables declared inside functions
only exist while the function is running and if a variable within the function
(a local variable) has the same name as a variable somewhere else in the code,
the local variable hides but doesn’t overwrite the other.</p>

<p>Every method used in Python (for example, <code class="language-plaintext highlighter-rouge">print</code>) is a function, and the
libraries we import (say, <code class="language-plaintext highlighter-rouge">pandas</code>) are a collection of functions. We will only
use functions that are housed within the same code that uses them, but
we can also write functions that can be used by different programs.</p>

<p>Functions are declared following this general structure:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">this_is_the_function_name</span><span class="p">(</span><span class="n">input_argument1</span><span class="p">,</span> <span class="n">input_argument2</span><span class="p">):</span>

    <span class="c1"># The body of the function is indented
</span>    <span class="c1"># This function prints the two arguments to screen
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'The function arguments are:'</span><span class="p">,</span> <span class="n">input_argument1</span><span class="p">,</span> <span class="n">input_argument2</span><span class="p">,</span> <span class="s">'(this is done inside the function!)'</span><span class="p">)</span>

    <span class="c1"># And returns their product
</span>    <span class="k">return</span> <span class="n">input_argument1</span> <span class="o">*</span> <span class="n">input_argument2</span>
</code></pre></div></div>

<p>The function declaration starts with the word <code class="language-plaintext highlighter-rouge">def</code>, followed by the function
name and any arguments in parenthesis, and ends in a colon. The body of the
function is indented just like loops are. If the function returns something when
it is called, it includes a return statement at the end.</p>

<p>This is how we call the function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">product_of_inputs</span> <span class="o">=</span> <span class="n">this_is_the_function_name</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The function arguments are: 2 5 (this is done inside the function!)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'Their product is:'</span><span class="p">,</span> <span class="n">product_of_inputs</span><span class="p">,</span> <span class="s">'(this is done outside the function!)'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Their product is: 10 (this is done outside the function!)
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---functions">Challenge - Functions</h2>

  <ol>
    <li>Change the values of the arguments in the function and check its output</li>
    <li>Try calling the function by giving it the wrong number of arguments (not 2)
  or not assigning the function call to a variable (no <code class="language-plaintext highlighter-rouge">product_of_inputs =</code>)</li>
    <li>Declare a variable inside the function and test to see where it exists (Hint:
  can you print it from outside the function?)</li>
    <li>Explore what happens when a variable both inside and outside the function
  have the same name. What happens to the global variable when you change the
  value of the local variable?</li>
  </ol>
</blockquote>

<p>We can now turn our code for saving yearly data files into a function. There are
many different “chunks” of this code that we can turn into functions, and we can
even create functions that call other functions inside them. Let’s first write a
function that separates data for just one year and saves that data to a file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">one_year_csv_writer</span><span class="p">(</span><span class="n">this_year</span><span class="p">,</span> <span class="n">all_data</span><span class="p">):</span>
    <span class="s">"""
    Writes a csv file for data from a given year.

    this_year -- year for which data is extracted
    all_data -- DataFrame with multi-year data
    """</span>

    <span class="c1"># Select data for the year
</span>    <span class="n">surveys_year</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">all_data</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">this_year</span><span class="p">]</span>

    <span class="c1"># Write the new DataFrame to a csv file
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="s">'data/yearly_files/function_surveys'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">this_year</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.csv'</span>
    <span class="n">surveys_year</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>

<p>The text between the two sets of triple double quotes is called a docstring and
contains the documentation for the function. It does nothing when the function
is running and is therefore not necessary, but it is good practice to include
docstrings as a reminder of what the code does. Docstrings in functions also
become part of their ‘official’ documentation, and we can see them by typing
<code class="language-plaintext highlighter-rouge">help(function_name)</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">help</span><span class="p">(</span><span class="n">one_year_csv_writer</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Help on function one_year_csv_writer in module __main__:

one_year_csv_writer(this_year, all_data)
    Writes a csv file for data from a given year.
    this_year -- year for which data is extracted
    all_data -- DataFrame with multi-year data
</code></pre></div></div>

<p>Or, when working in the Jupyter environment, adding a <code class="language-plaintext highlighter-rouge">?</code> (question mark) after the function name:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">one_year_csv_writer</span><span class="err">?</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">one_year_csv_writer</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>

<p>We changed the root of the name of the CSV file so we can distinguish it from
the one we wrote before. Check the <code class="language-plaintext highlighter-rouge">yearly_files</code> directory for the file. Did it
do what you expect?</p>

<p>What we really want to do, though, is create files for multiple years without
having to request them one by one. Let’s write another function that replaces
the entire <code class="language-plaintext highlighter-rouge">for</code> loop by looping through a sequence of years and repeatedly
calling the function we just wrote, <code class="language-plaintext highlighter-rouge">one_year_csv_writer</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">yearly_data_csv_writer</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">all_data</span><span class="p">):</span>
    <span class="s">"""
    Writes separate CSV files for each year of data.

    start_year -- the first year of data we want
    end_year -- the last year of data we want
    all_data -- DataFrame with multi-year data
    """</span>

    <span class="c1"># "end_year" is the last year of data we want to pull, so we loop to end_year+1
</span>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">one_year_csv_writer</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">all_data</span><span class="p">)</span>
</code></pre></div></div>

<p>Because people will naturally expect that the end year for the files is the last
year with data, the for loop inside the function ends at <code class="language-plaintext highlighter-rouge">end_year + 1</code>. By
writing the entire loop into a function, we’ve made a reusable tool for whenever
we need to break a large data file into yearly files. Because we can specify the
first and last year for which we want files, we can even use this function to
create files for a subset of the years available. This is how we call this
function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load the data into a DataFrame
</span><span class="n">surveys_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span>

<span class="c1"># Create CSV files
</span><span class="n">yearly_data_csv_writer</span><span class="p">(</span><span class="mi">1977</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="n">surveys_df</span><span class="p">)</span>
</code></pre></div></div>

<p>BEWARE! If you are using Jupyter Notebooks and you modify a function, you MUST
re-run that cell in order for the changed function to be available to the rest
of the code. Nothing will visibly happen when you do this, though, because
defining a function without <em>calling</em> it doesn’t produce an output. Any
cells that use the now-changed functions will also have to be re-run for their
output to change.</p>

<blockquote class="challenge">
  <h2 id="challenge-more-functions">Challenge: More functions</h2>

  <ol>
    <li>Add two arguments to the functions we wrote that take the path of the
directory where the files will be written and the root of the file name.
Create a new set of files with a different name in a different directory.</li>
    <li>How could you use the function <code class="language-plaintext highlighter-rouge">yearly_data_csv_writer</code> to create a CSV file
for only one year? (Hint: think about the syntax for <code class="language-plaintext highlighter-rouge">range</code>)</li>
    <li>Make the functions return a list of the files they have written. There are
many ways you can do this (and you should try them all!): either of the
functions can print to screen, either can use a return statement to give back
numbers or strings to their function call, or you can use some combination of
the two. You could also try using the <code class="language-plaintext highlighter-rouge">os</code> library to list the contents of
directories.</li>
    <li>Explore what happens when variables are declared inside each of the functions
versus in the main (non-indented) body of your code. What is the scope of the
variables (where are they visible)? What happens when they have the same name
  but are given different values?</li>
  </ol>
</blockquote>

<p>The functions we wrote demand that we give them a value for every argument.
Ideally, we would like these functions to be as flexible and independent as
possible. Let’s modify the function <code class="language-plaintext highlighter-rouge">yearly_data_csv_writer</code> so that the
<code class="language-plaintext highlighter-rouge">start_year</code> and <code class="language-plaintext highlighter-rouge">end_year</code> default to the full range of the data if they are
not supplied by the user. Arguments can be given default values with an equal
sign in the function declaration. Any arguments in the function without default
values (here, <code class="language-plaintext highlighter-rouge">all_data</code>) is a required argument and MUST come before the
argument with default values (which are optional in the function call).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">yearly_data_arg_test</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1977</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">2002</span><span class="p">):</span>
    <span class="s">"""
    Modified from yearly_data_csv_writer to test default argument values!

    start_year -- the first year of data we want (default 1977)
    end_year -- the last year of data we want (default 2002)
    all_data -- DataFrame with multi-year data
    """</span>

    <span class="k">return</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>


<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both optional arguments:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Default values:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Both optional arguments:	1988 1993
Default values:		1977 2002
</code></pre></div></div>

<p>The “\t” in the <code class="language-plaintext highlighter-rouge">print</code> statements are tabs, used to make the text align and be
easier to read.</p>

<p>But what if our dataset doesn’t start in 1977 and end in 2002? We can modify the
function so that it looks for the start and end years in the dataset if those
dates are not provided:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">yearly_data_arg_test</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""
    Modified from yearly_data_csv_writer to test default argument values!

    all_data -- DataFrame with multi-year data
    start_year -- the first year of data we want, Check all_data! (default None)
    end_year -- the last year of data we want; Check all_data! (default None)
    """</span>

    <span class="k">if</span> <span class="n">start_year</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_data</span><span class="p">.</span><span class="n">year</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end_year</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_data</span><span class="p">.</span><span class="n">year</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>


<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both optional arguments:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Default values:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Both optional arguments:	1988 1993
Default values:		1977 2002
</code></pre></div></div>

<p>The default values of the <code class="language-plaintext highlighter-rouge">start_year</code> and <code class="language-plaintext highlighter-rouge">end_year</code> arguments in the function
<code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> are now <code class="language-plaintext highlighter-rouge">None</code>. This is a built-in constant in Python
that indicates the absence of a value - essentially, that the variable exists in
the namespace of the function (the directory of variable names) but that it
doesn’t correspond to any existing object.</p>

<blockquote class="challenge">
  <h2 id="challenge---variables">Challenge - Variables</h2>

  <ol>
    <li>
      <p>What type of object corresponds to a variable declared as <code class="language-plaintext highlighter-rouge">None</code>? (Hint:
create a variable set to <code class="language-plaintext highlighter-rouge">None</code> and use the function <code class="language-plaintext highlighter-rouge">type()</code>)</p>
    </li>
    <li>
      <p>Compare the behavior of the function <code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> when the
arguments have <code class="language-plaintext highlighter-rouge">None</code> as a default and when they do not have default values.</p>
    </li>
    <li>
      <p>What happens if you only include a value for <code class="language-plaintext highlighter-rouge">start_year</code> in the function
call? Can you write the function call with only a value for <code class="language-plaintext highlighter-rouge">end_year</code>? (Hint:
think about how the function must be assigning values to each of the arguments -
this is related to the need to put the arguments without default values before
those with default values in the function definition!)</p>
    </li>
  </ol>
</blockquote>

<p>As we’ve written it so far, the function <code class="language-plaintext highlighter-rouge">yearly_data_arg_test</code> associates
values in the function call with arguments in the function definition just based
on their order. If the function gets only two values in the function call, the
first one will be associated with <code class="language-plaintext highlighter-rouge">all_data</code> and the second with <code class="language-plaintext highlighter-rouge">start_year</code>,
regardless of what we intended them to be. We can get around this problem by
calling the function using keyword arguments, where each of the arguments in the
function definition is associated with a keyword and the function call passes
values to the function using these keywords:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Default values:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'No keywords:</span><span class="se">\t\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1988</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both keywords, in order:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">1993</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1988</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Both keywords, flipped:</span><span class="se">\t\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1988</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'One keyword, default end:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">yearly_data_arg_test</span><span class="p">(</span><span class="n">surveys_df</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">1993</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'One keyword, default start:</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Default values:		1977 2002
No keywords:		1988 1993
Both keywords, in order:	1988 1993
Both keywords, flipped:	1988 1993
One keyword, default end:	1988 2002
One keyword, default start:	1977 1993
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge---modifying-functions">Challenge - Modifying functions</h2>

  <ol>
    <li>
      <p>Rewrite the <code class="language-plaintext highlighter-rouge">one_year_csv_writer</code> and <code class="language-plaintext highlighter-rouge">yearly_data_csv_writer</code> functions to
have keyword arguments with default values</p>
    </li>
    <li>
      <p>Modify the functions so that they don’t create yearly files if there is no
data for a given year and display an alert to the user (Hint: use conditional
statements to do this. For an extra challenge, use <code class="language-plaintext highlighter-rouge">try</code>
statements!)</p>
    </li>
    <li>
      <p>The code below checks to see whether a directory exists and creates one if it
doesn’t. Add some code to your function that writes out the CSV files, to check
for a directory to write to.</p>
    </li>
  </ol>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="s">'dir_name_here'</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">):</span>
   <span class="k">print</span><span class="p">(</span><span class="s">'Processed directory exists'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">'dir_name_here'</span><span class="p">)</span>
   <span class="k">print</span><span class="p">(</span><span class="s">'Processed directory created'</span><span class="p">)</span>
</code></pre></div>  </div>

  <ol>
    <li>The code that you have written so far to loop through the years is good,
however it is not necessarily reproducible with different datasets.
For instance, what happens to the code if we have additional years of data
in our CSV files? Using the tools that you learned in the previous activities,
make a list of all years represented in the data. Then create a loop to process
your data, that begins at the earliest year and ends at the latest year using
that list.</li>
  </ol>

  <p>HINT: you can create a loop with a list as follows: <code class="language-plaintext highlighter-rouge">for years in year_list:</code></p>
</blockquote>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Loops help automate repetitive tasks over sets of items.</p>
</li>
    
    <li><p>Loops combined with functions provide a way to process data more efficiently than we could by hand.</p>
</li>
    
    <li><p>Conditional statements enable execution of different operations on different data.</p>
</li>
    
    <li><p>Functions enable code reuse.</p>
</li>
    
  </ul>
</blockquote>

</article>


















  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="/04-visualization-ggplot-python/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="/07-visualization-ggplot-python/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2023
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://datacarpentry.org">Data Carpentry</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
    
    
    <a href="/edit//_episodes/05-loops-and-functions.md" data-checker-ignore>Edit on GitHub</a>
    
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/lesson.js"></script>


<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io"]]);
  _paq.push(["setDoNotTrack", true]);
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://carpentries.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->


<script src="/assets/js/anchor.min.js"></script>
<script>
    anchors.add();
</script>

  </body>
</html>
